ğŸ‘ LAMB ZK Gift Pool Zero-Knowledge Gift Cards â€“ Private Token Gifting with Circom + Groth16

Fully Production-Ready System + Secure Multi-Party Ceremony Guide

A privacy-preserving gifting system where:

Sender locks LAMB tokens

Generates a secret â†’ Poseidon hash â†’ gift ticket

Receiver redeems tokens using a zk-SNARK proof

Secret is never revealed on-chain

Nullifier prevents double claims

Partial claims supported

ğŸ”¥ Tornado-style privacy, but for gift cards and fully controlled + safe.

ğŸ“ Project Structure

project/
â”‚
â”œâ”€â”€ circuits/
â”‚   â”œâ”€â”€ giftcard.circom
â”‚   â”œâ”€â”€ poseidon.circom
â”‚   â”œâ”€â”€ build/
â”‚   â””â”€â”€ ptau/
â”‚
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ LambGiftPoolZK.sol
â”‚   â”œâ”€â”€ GiftCardVerifier.sol
â”‚
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ public/zk/
â”‚       â”œâ”€â”€ giftcard.wasm
â”‚       â”œâ”€â”€ giftcard_final.zkey
â”‚       â””â”€â”€ giftcard_verification_key.json
â”‚
â””â”€â”€ README.md


ğŸ”§ Install Dependencies Circom 2.1+ git clone https://github.com/iden3/circom.git cd circom cargo build --release sudo
cp target/release/circom /usr/local/bin/ circom --version

SnarkJS npm install -g snarkjs

ğŸ§© 1. Compile the Circuit circom circuits/giftcard.circom --r1cs --wasm --sym -o circuits/build

Outputs:

giftcard.r1cs

giftcard.wasm

giftcard.sym

/giftcard_js/ (witness generator)

âš¡ 2. Phase 1 â€” Powers of Tau mkdir -p circuits/ptau wget
https://hermez.s3-eu-west-1.amazonaws.com/powersOfTau28_hez_final_12.ptau \
 -O circuits/ptau/pot12_final.ptau

ğŸ” 3. Phase 2 â€” Multi-Party Trusted Setup (3â€“5 people)

This ensures that no single person controls the proving key.

Security model: If at least one participant destroys their toxic waste, the proving key is secure forever.

ğŸ”’ Ceremony Safety Checklist (All Participants)

Before contributing, each participant should:

Use a clean machine or VM

Disable terminal history:

set +o history

Use entropy generated by machine:

openssl rand -hex 64

Not livestream or record process

Delete intermediate .zkey files after passing them forward

Shut down VM when finished

âœ”ï¸ Step 1 â€” Coordinator Creates Initial ZKey snarkjs groth16 setup \
 circuits/build/giftcard.r1cs \
 circuits/ptau/pot12_final.ptau \
 circuits/build/giftcard_0000.zkey

Coordinator publishes:

sha256sum circuits/build/giftcard_0000.zkey

This ensures integrity before sending it to others.

âœ”ï¸ Step 2 â€” Each Participant Contributes Entropy

Each participant receives a .zkey file and generates the next one.

Example for Alice:

snarkjs zkey contribute \
 circuits/build/giftcard_0000.zkey \
 circuits/build/giftcard_0001.zkey \
 --name="Alice" \
 --entropy="$(openssl rand -hex 64)"

Participants chain:

giftcard_0000.zkey â†’ Alice â†’ giftcard_0001.zkey giftcard_0001.zkey â†’ Bob â†’ giftcard_0002.zkey giftcard_0002.zkey â†’ Carol
â†’ giftcard_0003.zkey giftcard_0003.zkey â†’ Dave â†’ giftcard_final.zkey

ğŸ” Verify File Integrity Before Passing Forward

Each participant must compute the hash of their output file:

sha256sum circuits/build/giftcard_0001.zkey

â€¦and send this hash + file to the next person.

The next person must confirm:

received file hash == sent hash

This prevents tampering.

ğŸ§¨ How Participants Delete Toxic Waste

After contribution:

âœ” Delete all old .zkey files:

rm circuits/build/giftcard_0000\*.zkey

âœ” Clear shell history (if needed):

history -c && history -w

âœ” Shut down VM or machine.

Once shutdown occurs â†’ RAM is wiped â†’ toxic waste gone.

âœ”ï¸ Step 3 â€” Coordinator Verifies Ceremony snarkjs zkey verify \
 circuits/build/giftcard.r1cs \
 circuits/ptau/pot12_final.ptau \
 circuits/build/giftcard_final.zkey

Publish:

sha256sum circuits/build/giftcard_final.zkey

ğŸ§¾ 4. Export Verification Key snarkjs zkey export verificationkey \
 circuits/build/giftcard_final.zkey \
 circuits/build/giftcard_verification_key.json

ğŸ—ï¸ 5. Generate Solidity Verifier snarkjs zkey export solidityverifier \
 circuits/build/giftcard_final.zkey \
 contracts/GiftCardVerifier.sol

ğŸ§± 6. Deploy Smart Contracts

Deploy GiftCardVerifier.sol

Deploy LambGiftPoolZK.sol:

constructor(address \_lambToken, address \_verifier)

ğŸ§ª 7. Frontend Proof Generation

Place files in:

frontend/public/zk/giftcard.wasm frontend/public/zk/giftcard_final.zkey
frontend/public/zk/giftcard_verification_key.json

Example Proof Generator import \* as snarkjs from "snarkjs"; import { poseidon } from "circomlibjs";

export async function generateGiftProof(secret, amount) { const claimHash = poseidon([secret]); const nullifier =
poseidon([secret, amount]);

const input = { secret: secret.toString(), amount: amount.toString(), claimHash: claimHash.toString(), nullifier:
nullifier.toString() };

const { proof, publicSignals } = await snarkjs.groth16.fullProve( input, "/zk/giftcard.wasm", "/zk/giftcard_final.zkey"
);

return { proof, publicSignals }; }
